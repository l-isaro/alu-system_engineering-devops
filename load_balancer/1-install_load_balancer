#!/usr/bin/env bash
# script installs HA proxy and configures it

apt-get -y install software-properties-common
add-apt-repository ppa:vbernat/haproxy-1.8
sudo apt-get update
sudo apt-get install haproxy
echo "ENABLED=1" | sudo tee /etc/default/haproxy

sudo cp /etc/haproxy/haproxy.cfg /etc/haproxy/haproxy.real.cfg

echo -e "\n frontend http
  bind *:80
  mode http
  default_backend site_backend
  
  backend site_backend
  balance roundrobin
  server web-01 3.89.244.51:80 check
  server web-02 107.23.186.148:80 check
  " | sudo tee -a /etc/haproxy/haproxy.cfg

sudo service haproxy restart
